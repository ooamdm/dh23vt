(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{3682:(e,t,n)=>{Promise.resolve().then(n.bind(n,6049))},6049:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var o=n(5155),r=n(9137),s=n.n(r),a=n(2115);n(9324);var c=n(3915),i=n(5404),l=n(5317);let d={apiKey:"AIzaSyBBHslUkDMk0A0CztD2B0OD3ZZ2ukC9xFs",authDomain:"dh23vt-aa5b0.firebaseapp.com",projectId:"dh23vt-aa5b0",storageBucket:"dh23vt-aa5b0.firebasestorage.app",messagingSenderId:"788614645336",appId:"1:788614645336:web:66c64a10ec60dee87cec2d",measurementId:"G-WZ5LJ1JGCM"},u={apiKey:"AIzaSyDfDvoLxhoG7PeiRIEWCKEUuCuaKKKL61U",authDomain:"dh23vt---1-ab2dd.firebaseapp.com",projectId:"dh23vt---1-ab2dd",storageBucket:"dh23vt---1-ab2dd.firebasestorage.app",messagingSenderId:"854957062400",appId:"1:854957062400:web:36cab5d3d079d4fcb21be5",measurementId:"G-33MX17W5VL"};async function h(e,t){let n=new i.HF;try{return await (0,i.df)(e,n),!0}catch(e){return console.error("Error signing in for ".concat(t,":"),e),!1}}async function g(e,t){try{await Promise.all([(0,i.CI)(e).catch(()=>{}),(0,i.CI)(t).catch(()=>{})])}catch(e){console.warn("Lỗi khi đăng xuất: ",e)}finally{sessionStorage.removeItem("studentActivities"),sessionStorage.removeItem("cachedProject"),sessionStorage.removeItem("currentProject"),console.log("Đ\xe3 đăng xuất khỏi cả hai project v\xe0 xo\xe1 cache.")}}let m=function(e){let{user:t,onSignOut:n}=e;return(0,o.jsx)("header",{className:"bg-white shadow-md sticky top-0 z-10",children:(0,o.jsx)("div",{className:"container-fluid px-4 sm:px-6 lg:px-8",children:(0,o.jsxs)("div",{className:"flex items-center justify-between h-16 py-3",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("i",{className:"fas fa-chart-line text-2xl text-blue-600 me-3"}),(0,o.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-0",children:"Dashboard"})]}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("div",{id:"user-info",className:"text-right me-3 hidden sm:block",children:[(0,o.jsx)("p",{id:"user-name",className:"font-semibold text-gray-800 mb-0",children:(null==t?void 0:t.displayName)||""}),(0,o.jsx)("p",{id:"user-email",className:"text-sm text-gray-500 mb-0",children:(null==t?void 0:t.email)||""})]}),(0,o.jsx)("img",{id:"user-photo",className:"h-10 w-10 rounded-full me-3",src:(null==t?void 0:t.photoURL)||"https://placehold.co/40x40/aabbcc/ffffff?text=User",alt:"User photo"}),(0,o.jsxs)("button",{id:"logout-btn",className:"btn btn-danger btn-sm",onClick:n,children:[(0,o.jsx)("i",{className:"fas fa-sign-out-alt me-2"}),"Đăng xuất"]})]})]})})})},p=function(e){let{onSignIn:t}=e;return(0,o.jsxs)("div",{id:"login-page",className:"min-h-screen flex items-center justify-center bg-gray-50",children:["\xa0 \xa0 ",(0,o.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-xl shadow-lg text-center",children:["\xa0 \xa0 \xa0 \xa0 ",(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2 animate-fade-in",children:"Dashboard Sinh Vi\xean"}),"\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsx)("p",{className:"text-gray-600 mb-6 animate-fade-in-delay-1",children:"Vui l\xf2ng đăng nhập để tiếp tục"}),"\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsxs)("div",{className:"bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-6 rounded-md shadow-inner animate-slide-up-fade-in",children:["\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsx)("p",{className:"font-semibold",children:"Hey Gen Z ✌️"}),"\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsx)("p",{className:"text-sm",children:"Nếu bạn được chuyển từ Softr sang đ\xe2y để xem điểm th\xec ch\xfac mừng bạn, bạn đ\xe3 đến đ\xfang nơi!! \uD83D\uDD25"}),"\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsx)("p",{className:"text-sm mt-2",children:"H\xe3y login bằng t\xe0i khoản Google sinh vi\xean của bạn để bắt đầu nh\xe9!"}),"\xa0 \xa0 \xa0 \xa0 "]}),"\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsxs)("button",{id:"login-btn",className:"w-full btn btn-lg btn-custom btn-google flex items-center justify-center",onClick:t,children:["\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsx)("i",{className:"fab fa-google me-3"}),"\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 Đăng nhập với Google \xa0 \xa0 \xa0 \xa0 "]}),"\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ","\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsxs)("div",{className:"text-right mt-8",children:["\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsx)("p",{className:"text-lg font-signature",children:"Hồ Quốc Thắng"}),"\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsx)("p",{className:"text-sm text-gray-500",children:"Người quản trị"}),"\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 "]}),"\xa0 \xa0 "]})]})};void 0!==window.__app_id&&window.__app_id,void 0!==window.__firebase_config&&JSON.parse(window.__firebase_config);let b=void 0!==window.__initial_auth_token?window.__initial_auth_token:null;function f(e){let{children:t}=e,[n,r]=(0,a.useState)({}),[f,x]=(0,a.useState)({}),[j,y]=(0,a.useState)({}),[w,v]=(0,a.useState)("projectA"),[k,S]=(0,a.useState)(null),[N,C]=(0,a.useState)({projectA:null,projectB:null}),[A,L]=(0,a.useState)([]),[_,P]=(0,a.useState)({key:"T\xean hoạt động",order:"asc"}),[I,B]=(0,a.useState)(""),[D,F]=(0,a.useState)(!1),[K,E]=(0,a.useState)(!1),[U,G]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{let e={},t={},n={};(0,c.Dk)().some(e=>"projectA"===e.name)?e.projectA=(0,c.Dk)().find(e=>"projectA"===e.name):e.projectA=(0,c.Wp)(u,"projectA"),t.projectA=(0,i.xI)(e.projectA),n.projectA=(0,l.aU)(e.projectA),(0,c.Dk)().some(e=>"projectB"===e.name)?e.projectB=(0,c.Dk)().find(e=>"projectB"===e.name):e.projectB=(0,c.Wp)(d,"projectB"),t.projectB=(0,i.xI)(e.projectB),n.projectB=(0,l.aU)(e.projectB),r(e),x(t),y(n),(0,i.hg)(t.projectA,e=>{C(t=>({...t,projectA:e})),"projectA"===w&&O(e,"projectA")}),(0,i.hg)(t.projectB,e=>{C(t=>({...t,projectB:e})),"projectB"===w&&O(e,"projectB")});try{b&&t.projectA?(await (0,i.p)(t.projectA,b),console.log("Đ\xe3 đăng nhập bằng custom token cho Project A.")):t.projectA&&(await (0,i.zK)(t.projectA),console.log("Đ\xe3 đăng nhập ẩn danh cho Project A."))}catch(e){console.error("X\xe1c thực thất bại:",e)}finally{E(!0)}})()},[]),(0,a.useEffect)(()=>{j[w]&&S(j[w])},[w,j]);let O=(0,a.useCallback)((e,t)=>{e&&w===t?(M(H()),G(!1)):N.projectA||N.projectB||!K||G(!0)},[w,N,K]),H=(0,a.useCallback)(()=>{let e=N[w];return e?e.email:null},[w,N]),M=(0,a.useCallback)(async e=>{let t=sessionStorage.getItem("studentActivities"),n=sessionStorage.getItem("cachedProject");if(t&&w===n)try{L(JSON.parse(t));return}catch(e){console.warn("Lỗi ph\xe2n t\xedch c\xfa ph\xe1p cache, đang lấy dữ liệu mới",e)}await T(e)},[w]),T=(0,a.useCallback)(async e=>{if(!e||!k){console.error("Lỗi: Kh\xf4ng c\xf3 email hoặc cơ sở dữ liệu để tải dữ liệu."),F(!1);return}if(console.log("Đang lấy dữ liệu mới từ Firestore Project: ".concat(w,"...")),F(!0),!f[w].currentUser&&(console.warn("Người d\xf9ng chưa đăng nhập v\xe0o Project ".concat(w,". Đang cố gắng đăng nhập.")),!await h(f[w],w))){console.error("Kh\xf4ng thể lấy dữ liệu v\xec đăng nhập v\xe0o Project ".concat(w," thất bại.")),F(!1);return}let t=function(e,t,n,o,r){if(!e||!t)return r(Error("Database instance or email is missing.")),()=>{};let s=(0,l.rJ)(e,"studentActivities"),a=(0,l.P)(s,(0,l._M)("Email","==",t));return(0,l.aQ)(a,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t)},e=>{(function(e){let t=String((null==e?void 0:e.code)||"").toLowerCase(),n=String((null==e?void 0:e.message)||"").toLowerCase();t.includes("resource-exhausted")||n.includes("quota")||n.includes("exhausted")?console.error("Lỗi Firestore: Kho dữ liệu hiện tại đang qu\xe1 tải (hết quota).",e):t.includes("permission-denied")||n.includes("permission-denied")?console.error("Lỗi Firestore: Kh\xf4ng c\xf3 quyền truy cập dữ liệu cho kho n\xe0y. Vui l\xf2ng kiểm tra Rules hoặc đăng nhập lại.",e):console.error("Lỗi Firestore: Kh\xf4ng thể tải dữ liệu từ server. Vui l\xf2ng kiểm tra kết nối.",e)})(e),r(e)})}(k,e,0,e=>{L(e),sessionStorage.setItem("studentActivities",JSON.stringify(e)),sessionStorage.setItem("cachedProject",w),console.log("Dữ liệu đ\xe3 được l\xe0m mới v\xe0 lưu v\xe0o cache."),F(!1)},e=>{console.error("Lỗi khi lắng nghe dữ liệu từ Firestore: ",e),F(!1)});return()=>t()},[w,k,f]);(0,a.useEffect)(()=>{if(k&&K){let e=H();if(e){let t=T(e);return()=>{t&&"function"==typeof t&&t()}}L([])}},[k,K,H,T]);let J=(0,a.useCallback)(async e=>N[e]?(console.log("Người d\xf9ng đ\xe3 đăng nhập v\xe0o Project ".concat(e,".")),!0):(console.log("Người d\xf9ng chưa đăng nhập v\xe0o Project ".concat(e,". Đang cố gắng đăng nhập tự động...")),await h(f[e],e)),[N,f]);(0,a.useCallback)(async e=>w===e?void console.log("Đ\xe3 ở Project ".concat(e,". Kh\xf4ng cần chuyển đổi.")):(console.log("Đang y\xeau cầu chuyển đổi sang Project: ".concat(e)),await J(e))?void(v(e),sessionStorage.setItem("currentProject",e),console.log("Đ\xe3 chuyển sang Project: ".concat(e))):void console.error("Kh\xf4ng thể chuyển sang Project ".concat(e," v\xec đăng nhập thất bại.")),[w,J,f]),(0,a.useCallback)(e=>{switch(e){case"Ph\xea duyệt":case"Sent":return"bg-green-100 text-green-700";case"Đang xử l\xfd":case"Processing":return"bg-yellow-100 text-yellow-700";case"Từ chối":case"Cancelled":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}},[]);let q=(0,a.useCallback)(e=>{let t=["c\xe1n bộ","Ban chấp h\xe0nh","gương mẫu","ho\xe0n th\xe0nh tốt","Đo\xe0n","Hội"],n=["Nghi\xean cứu khoa học","Dự \xe1n khoa học"],o=["CLB học thuật","Hội thảo học thuật"],r=0;e.some(e=>t.some(t=>String(e["T\xean hoạt động"]||"").toLowerCase().includes(t.toLowerCase())))&&r++,e.some(e=>n.some(t=>String(e["T\xean hoạt động"]||"").toLowerCase().includes(t.toLowerCase()))&&"ph\xea duyệt"===String(e.Status||"").toLowerCase())&&r++,e.some(e=>o.some(t=>String(e["T\xean hoạt động"]||"").toLowerCase().includes(t.toLowerCase()))&&"ph\xea duyệt"===String(e.Status||"").toLowerCase())&&r++;let s="";return s=0===r?"Nh\xf3m 90":1===r?"Nh\xf3m 95":"Nh\xf3m 100",{points:r,group:s}},[]),z=(0,a.useCallback)(e=>[...e].sort((e,t)=>{var n,o;let r=null!=(n=e[_.key])?n:"",s=null!=(o=t[_.key])?o:"";if("Điểm cộng"===_.key){let e=Number.isFinite(parseFloat(String(r).replace(",",".")))?parseFloat(String(r).replace(",",".")):-1/0,t=Number.isFinite(parseFloat(String(s).replace(",",".")))?parseFloat(String(s).replace(",",".")):-1/0;return"asc"===_.order?e-t:t-e}let a=String(r).toLowerCase(),c=String(s).toLowerCase();return a<c?"asc"===_.order?-1:1:a>c?"asc"===_.order?1:-1:0}),[_]);(0,a.useMemo)(()=>z(A.filter(e=>Object.values(e||{}).some(e=>String(e||"").toLowerCase().includes(I.toLowerCase())))),[A,I,z]),(0,a.useMemo)(()=>{let e=A.length,t=A.filter(e=>"Ph\xea duyệt"===e.Status).length,n=A.filter(e=>"Đang chờ"===e.Status).length,o=A.filter(e=>"Kh\xf4ng ph\xea duyệt"===e.Status).length,r=A.reduce((e,t)=>{let n=parseFloat(String(t["Điểm cộng"]).replace(",","."));return e+(Number.isFinite(n)?n:0)},0),s=A.filter(e=>"Ph\xea duyệt"===e.Status),a=s.reduce((e,t)=>{let n=parseFloat(String(t["Điểm cộng"]).replace(",","."));return e+(Number.isFinite(n)?n:0)},0),c=A.length>0?q(A):{group:"N/A"};return console.log("Mảng hoạt động đ\xe3 được ph\xea duyệt:",s),console.log("Tổng điểm đ\xe3 ph\xea duyệt:",a),{totalActivities:e,sentCount:t,processingCount:n,cancelledCount:o,totalPoints:r.toFixed(2),totalApprovedPoints:a.toFixed(2),classificationGroup:c.group}},[A,q]);let V=N[w];return(0,o.jsx)("html",{lang:"vi",children:(0,o.jsx)("body",{children:(0,o.jsxs)("div",{className:"jsx-86dbf86fb5d4e436 antialiased text-gray-800",children:[(0,o.jsx)(s(),{id:"86dbf86fb5d4e436",children:'body{font-family:"Inter",sans-serif;background-color:#f3f4f6}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:#f1f1f1}::-webkit-scrollbar-thumb{background:#888;border-radius:10px}::-webkit-scrollbar-thumb:hover{background:#555}.sort-icon{opacity:.5;transition:opacity.2s;margin-left:.5rem}.sort-icon:hover{opacity:1}.th-sortable{cursor:pointer}.card-custom{transition:transform.2s ease-in-out}.card-custom:hover{transform:translatey(-5px)}.btn-custom{padding:10px 20px;border-radius:8px;font-weight:600}.btn-google{background-color:#4285F4;color:white}.btn-google:hover{background-color:#357AE8}@media(max-width:575.98px){.search-refresh-group .input-group{width:100%;margin-bottom:1rem}.search-refresh-group .btn{width:100%}.project-selector .btn{margin-bottom:.5rem}}'}),U?(0,o.jsx)(p,{onSignIn:()=>h(f[w],w)}):(0,o.jsxs)("div",{id:"dashboard-page",className:"jsx-86dbf86fb5d4e436",children:[(0,o.jsx)(m,{user:V,onSignOut:()=>g(f.projectA,f.projectB)}),(0,o.jsx)("main",{className:"jsx-86dbf86fb5d4e436 container mx-auto py-4 px-4",children:t})]})]})})})}},9324:()=>{}},e=>{e.O(0,[533,135,965,305,441,964,358],()=>e(e.s=3682)),_N_E=e.O()}]);